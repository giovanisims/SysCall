<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://kit.fontawesome.com/a97e2a6b17.js" crossorigin="anonymous"></script>
    <link rel="icon" type="image/x-icon" href="/static/images/logo.ico">
    <link rel="stylesheet" href="/static/css/users_crud.css">
    <title>SysCall</title>
</head>

<body>
    <header>
        <div class="logo">
            <a href="/"><svg width="50" height="50" viewBox="0 0 83 85" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd"
                        d="M30.2745 1.09757C19.3035 4.69257 7.81948 15.2016 4.15248 25.0016C2.96248 28.1826 1.98848 31.4176 1.98848 32.1886C1.98848 32.9606 1.53848 33.8706 0.988481 34.2106C-0.584519 35.1826 -0.191517 48.2186 1.54048 52.5496C3.06848 56.3666 5.20248 58.0416 9.83748 59.0596C11.8815 59.5086 12.0945 59.2926 11.4755 57.3926C11.0855 56.1926 10.5415 50.4106 10.2695 44.5436C9.59348 30.0236 11.1595 25.3336 19.3995 17.2016C26.7135 9.98257 33.0025 7.36457 42.6375 7.52857C53.1265 7.70757 62.2885 12.8286 67.9755 21.6906C72.1825 28.2456 73.0475 31.6786 73.1625 42.2576C73.2395 49.3226 72.8175 52.3076 71.2375 55.8806C67.1005 65.2326 58.9035 71.4546 48.4885 73.1476C44.9585 73.7216 44.3715 73.5286 43.4885 71.5036C42.6015 69.4686 41.7965 69.2116 36.3375 69.2166C29.3995 69.2226 25.9885 71.2716 25.9885 75.4316C25.9885 80.9336 30.8235 84.7106 37.8675 84.7106C41.5205 84.7106 44.9885 82.7956 44.9885 80.7786C44.9885 80.3446 47.2735 79.7186 50.0655 79.3876C61.9505 77.9806 74.4485 68.6826 79.5765 57.4326C85.9105 43.5406 81.6905 23.3176 70.0225 11.6496C67.3915 9.01857 62.3705 5.41457 58.8635 3.64057C53.3695 0.861566 51.2445 0.367576 43.4885 0.0665764C37.6365 -0.161424 33.0145 0.199567 30.2745 1.09757ZM25.4225 23.9606C18.9075 31.6786 17.2765 41.3366 21.0725 49.7106C24.7885 57.9086 28.4245 60.3086 32.5475 57.2886C34.4565 55.8906 34.4505 55.8196 32.2295 53.0386C28.9235 48.8996 27.8025 45.7746 27.7785 40.6336C27.7555 35.6766 29.5655 31.3086 32.8865 28.3036C35.4915 25.9456 35.5045 25.2266 32.9885 22.7106C30.2095 19.9316 28.5995 20.1976 25.4225 23.9606ZM50.5875 23.6016C48.9585 25.4006 49.0365 25.7196 52.1825 30.1866C55.0125 34.2056 55.4795 35.6956 55.4295 40.5456C55.3725 45.9596 54.2485 49.0606 50.4055 54.3946C48.9055 56.4766 48.9815 56.6556 52.0125 58.2226C55.0815 59.8096 55.2805 59.7856 57.6875 57.5386C65.9435 49.8346 66.2645 35.3166 58.4065 25.0146C55.5575 21.2796 53.0915 20.8336 50.5875 23.6016ZM37.4845 34.4936C33.7245 37.7156 35.0805 47.3806 39.5335 49.0896C44.5855 51.0286 47.9885 47.8436 47.9885 41.1766C47.9885 34.0816 42.2375 30.4226 37.4845 34.4936Z"
                        fill="#F2E9E4" />
                </svg></a>
        </div>

        <!-- get ready for the most horrendous code you'll ever see, just cry over it front end developer, cuz it is working (probably)and there is nothing you can do about it -->

        {% if user_role == "System Administrator" %} <!-- fuck this role name and you that made the fucking database -->

        <nav id="navBar">
            <ul class="menu">
                <li class="menu-items"><a href="/tickets_crud">Chamados</a></li>
                <li class="menu-items"><a href="users_crud">Usuários</a></li>
                <li class="menu-items"><a href="/contact">Contato</a></li>
            </ul>
        </nav>

        {% elif user_role == "User" %}

        <nav id="navBar">
            <ul class="menu">
                <li class="menu-items"><a href="/tickets">Meus chamados</a></li>
                <li class="menu-items"><a href="/contact">Contato</a></li>
            </ul>
        </nav>

        {% elif user_role == "Technician" %}

        <nav id="navBar">
            <ul class="menu">
                <li class="menu-items"><a href="/tickets">Chamados</a></li>
                <li class="menu-items"><a href="/contact">Contato</a></li>
            </ul>
        </nav>

        {% else %}

        <nav id="navBar">
            <ul class="menu">
                <li class="menu-items"><a href="/login">Meus chamados</a></li>
                <li class="menu-items"><a href="/login">Contato</a></li>
            </ul>
        </nav>

        {% endif %}



        <div class="icons">
            {% if user_name %}
            <p class="hello-user"><a href="">Olá, {{ user_name }}</a></p>
            {% else %}
            <p class="hello-user" style="visibility: hidden">Olá, Usuário</p>
            {% endif %}
            <a href=""><i class="fa-solid fa-circle-user"></i></a>
            <i id="menuButton" class="fa-solid fa-bars"></i>
        </div>
        <div id="userModal" class="dropdown-modal">
            <div class="triangle"></div>
            <div class="modal-content">
                <ul>
                    {% if not user_name %}
                    <li><a href="/login">Entrar</a></li>
                    <li><a href="/sign_up">Cadastrar-se</a></li>
                    {% else %}
                    <li><a href="/profile">Editar Perfil</a></li>
                    <li><a href="/logout">Sair</a></li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </header>
    <div class="title">
        <h1>Usuários</h1>
        <a class="add" href="#" onclick="openModalForm()"><i class="fa-solid fa-plus" style="color: #f2e9e4;"></i>Adicionar</a>
    </div>
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nome</th>
                    <th>Username</th>
                    <th>Email</th>
                    <th>CPF</th>
                    <th>CEP</th>
                    <th>Telefone</th>
                    <th>Endereço</th>
                    <th>Complemento</th>
                    <th>Função</th>
                    <th colspan="2">Ações</th>
                </tr>
            </thead>
            <tbody id="users-table-body">
                {% for user in users %}
                <tr>
                    <td data-label="ID">{{ user.idUser }}</td>
                    <td data-label="Nome">{{ user.NameSurname }}</td>
                    <td data-label="Username">{{ user.Username }}</td>
                    <td data-label="Email">{{ user.Email }}</td>
                    <td data-label="CPF">{{ user.CPF }}</td>
                    <td data-label="CEP">{{ user.CEP }}</td>
                    <td data-label="Telefone">{{ user.Number }}</td>
                    <td data-label="Endereço">{{ user.Address }}</td>
                    <td data-label="Complemento">{% if user.Complement == None or user.Complement == 'None' %}{% else %}{{ user.Complement }}{% endif %}</td>
                    <td data-label="Função">{{ user.Role }}</td>
                    <td class="action-button-table" data-label="Ações">
                        <button class="edit-link" title="Editar usuário"
                            onclick="openEditModal('{{ user.idUser }}', '{{ user.NameSurname }}', '{{ user.Username }}', '{{ user.Email }}', '{{ user.CPF }}', '{{ user.CEP }}', '{{ user.Number }}', '{{ user.Address }}', '{{ user.Role }}', '{{ user.Complement }}')">
                            <i class="fa-solid fa-pen-to-square" style="color: #125dde;"></i>
                        </button>
                        <button class="delete-link" title="Excluir usuário" onclick="openModal('{{ user.idUser }}')">
                            <i class="fa-solid fa-trash" style="color: #921f1f;"></i>
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <!-- Modal de Confirmação -->
    <div id="confirmationModal" class="modal">
        <div class="modal-content">
            <p>Tem certeza que deseja excluir este usuário?</p>
            <button id="confirmDeleteBtn" class="confirm-delete">Confirmar</button>
            <button id="cancelDeleteBtn" onclick="closeModal()">Cancelar</button>
        </div>
    </div>
    <!-- Modal de Edição -->
    <div id="editModal" class="modal">
        <div class="modal-content edit-modal-content">
            <h2>Editar Usuário</h2>
            {% if edit_error %}
            <div id="backendEditError" class="backend-error-msg" style="color: #921f1f; margin-bottom: 10px; text-align: center; display: block;">
                {{ edit_error }}
            </div>
            {% else %}
            <div id="backendEditError" class="backend-error-msg" style="color: #921f1f; margin-bottom: 10px; text-align: center; display: none;"></div>
            {% endif %}
            <form id="editUserForm" method="post" action="/users/edit">
                <input type="hidden" id="editUserId" name="user_id" value="{{ edit_user_id|default('') }}">
                <div class="form-group">
                    <label for="editName">Nome:</label>
                    <input type="text" id="editName" name="name" class="required" value="{{ edit_name|default('') }}">
                </div>
                <div class="form-group">
                    <label for="editUsername">Username:</label>
                    <input type="text" id="editUsername" name="username" class="required" value="{{ edit_username|default('') }}">
                </div>
                <div class="form-group">
                    <label for="editEmail">Email:</label>
                    <input type="email" id="editEmail" name="email" class="required" value="{{ edit_email|default('') }}">
                </div>
                <div class="form-group">
                    <label for="editCPF">CPF:</label>
                    <input type="text" id="editCPF" name="cpf" class="required" maxlength="11" value="{{ edit_cpf|default('') }}">
                </div>
                <div class="form-group">
                    <label for="editCEP">CEP:</label>
                    <input type="text" id="editCEP" name="cep" class="required" maxlength="9" value="{{ edit_cep|default('') }}">
                </div>
                <div class="form-group">
                    <label for="editPhone">Telefone:</label>
                    <input type="text" id="editPhone" name="phone" class="required" maxlength="12" value="{{ edit_phone|default('') }}">
                </div>
                <div class="form-group">
                    <label for="editAddress">Endereço:</label>
                    <input type="text" id="editAddress" name="address" class="required" value="{{ edit_address|default('') }}">
                </div>
                <div class="form-group">
                    <label for="editObservation">Complemento:</label>
                    <input type="text" id="editObservation" name="observation" value="{{ edit_observation|default('') }}">
                </div>
                <div class="form-group">
                    <label for="editRole">Função:</label>
                    <select id="editRole" name="role" class="required">
                        <option value="3" {% if edit_role == 3 %}selected{% endif %}>Administrador</option>
                        <option value="1" {% if edit_role == 1 %}selected{% endif %}>Usuário</option>
                        <option value="2" {% if edit_role == 2 %}selected{% endif %}>Técnico</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editPassword">Senha:</label>
                    <input type="password" id="editPassword" name="password" value="{{ edit_password|default('') }}">
                </div>
                <div class="form-group see-password-container">
                    <div class="see-password-checkbox-container">
                        <input type="checkbox" id="editSeePassword" name="seePassword" class="see-password-checkbox">
                    </div>
                    <label for="editSeePassword" class="see-password-label">Mostrar a senha</label>
                </div>
                <div class="error-message-container">
                    <p id="errorEditName" class="error-message" style="display: none;">Nome inválido. Use apenas letras e espaços.</p>
                    <p id="errorEditUsername" class="error-message" style="display: none;">Username inválido.</p>
                    <p id="errorEditEmail" class="error-message" style="display: none;">Email inválido.</p>
                    <p id="errorEditCpf" class="error-message" style="display: none;">CPF inválido.</p>
                    <p id="errorEditCep" class="error-message" style="display: none;">CEP inválido.</p>
                    <p id="errorEditPhone" class="error-message" style="display: none;">Telefone inválido.</p>
                    <p id="errorEditPassword" class="error-message" style="display: none;">A senha deve conter uma letra maiúscula, uma letra minúscula, um número, um caractere especial e 8 digitos.</p>
                    <p id="errorEditFields" class="error-message" style="display: none;">Preencha todos os campos obrigatórios.</p>
                </div>
                <div class="action-button-modal">
                    <button type="button" id="editSubmitButtonVisible" class="save-button">Salvar</button>
                    <button type="submit" id="editSubmitButton" style="display: none;"></button>
                    <button type="button" class="cancel-button" onclick="closeEditModal()">Cancelar</button>
                </div>
            </form>
        </div>
    </div>
    <div id="modalOpenUser" class="modal">
        <div class="modal-content edit-modal-content">
            <h2>Adicionar Novo Usuário</h2>
            {% if error %}
            <div id="backendAddError" class="backend-error-msg" style="color: #921f1f; margin-bottom: 10px; text-align: center; display: block;">
                {{ error }}
            </div>
            {% else %}
            <div id="backendAddError" class="backend-error-msg" style="color: #921f1f; margin-bottom: 10px; text-align: center; display: none;"></div>
            {% endif %}
            <form id="formUser" action="/users/submit" method="POST">
                <input type="hidden" name="where" value="2">
                <div class="form-group">
                    <label for="addName">Nome:</label>
                    <input type="text" id="addName" name="namesurname" class="required" value="{{ namesurname|default('') }}" />
                </div>
                <div class="form-group">
                    <label for="addUsername">Username:</label>
                    <input type="text" id="addUsername" name="username" class="required" value="{{ username|default('') }}" />
                </div>
                <div class="form-group">
                    <label for="addEmail">Email:</label>
                    <input type="email" id="addEmail" name="email" class="required" value="{{ email|default('') }}" />
                </div>
                <div class="form-group">
                    <label for="addCPF">CPF:</label>
                    <input type="text" id="addCPF" name="cpf" class="required" maxlength="11" value="{{ cpf|default('') }}" />
                </div>
                <div class="form-group">
                    <label for="addCEP">CEP:</label>
                    <input type="text" id="addCEP" name="cep" class="required" maxlength="9" value="{{ cep|default('') }}" />
                </div>
                <div class="form-group">
                    <label for="addPhone">Telefone:</label>
                    <input type="text" id="addPhone" name="phone" class="required" maxlength="12" value="{{ phone|default('') }}" />
                </div>
                <div class="form-group">
                    <label for="addAddress">Endereço:</label>
                    <input type="text" id="addAddress" name="address" class="required" value="{{ address|default('') }}" />
                </div>
                <div class="form-group">
                    <label for="addObservation">Complemento:</label>
                    <input type="text" id="addObservation" name="observation" value="{{ observation|default('') }}" />
                </div>
                <div class="form-group">
                    <label for="addRole">Função:</label>
                    <select id="addRole" name="role" class="required">
                        <option value="3" {% if role == 3 %}selected{% endif %}>Administrador</option>
                        <option value="1" {% if role == 1 %}selected{% endif %}>Usuário</option>
                        <option value="2" {% if role == 2 %}selected{% endif %}>Técnico</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="addPassword">Senha:</label>
                    <input type="password" id="addPassword" name="password" class="required" value="{{ password|default('') }}" />
                </div>
                <div class="form-group">
                    <label for="addPasswordConfirm">Confirmar senha:</label>
                    <input type="password" id="addPasswordConfirm" name="passwordConfirm" class="required" value="{{ passwordConfirm|default('') }}" />
                </div>
                <div class="form-group see-password-container">
                    <div class="see-password-checkbox-container">
                        <input type="checkbox" id="addSeePassword" name="seePassword" class="see-password-checkbox">
                    </div>
                    <label for="addSeePassword" class="see-password-label">Mostrar a senha</label>
                </div>
                <div class="error-message-container">
                    <p id="errorAddName" class="error-message" style="display: none;">Nome inválido. Use apenas letras e espaços.</p>
                    <p id="errorAddUsername" class="error-message" style="display: none;">Username inválido.</p>
                    <p id="errorAddEmail" class="error-message" style="display: none;">Email inválido.</p>
                    <p id="errorAddCpf" class="error-message" style="display: none;">CPF inválido.</p>
                    <p id="errorAddCep" class="error-message" style="display: none;">CEP inválido.</p>
                    <p id="errorAddPhone" class="error-message" style="display: none;">Telefone inválido.</p>
                    <p id="errorAddPassword" class="error-message" style="display: none;">A senha deve conter uma letra maiúscula, uma letra minúscula, um número, um caractere especial e 8 digitos.</p>
                    <p id="errorAddEqualPasswords" class="error-message" style="display: none;">As senhas devem ser iguais.</p>
                    <p id="errorAddFields" class="error-message" style="display: none;">Preencha todos os campos obrigatórios.</p>
                </div>
                <div class="action-button-modal">
                    <button type="button" id="addSubmitButtonVisible" class="sendForm btn">Enviar</button>
                    <button type="submit" id="addSubmitButton" style="display: none;"></button>
                    <button type="button" class="cancel-button" onclick="closeModalForm()">Cancelar</button>
                </div>
            </form>
        </div>
    </div>
    <!-- Modal de Sucesso -->
    <div id="successModal" class="modal">
        <div class="modal-content success-modal-content">
            <p id="successMessageText"></p>
            <button id="closeSuccessBtn">OK</button>
        </div>
    </div>
    <script src="/static/js/users_crud.js"></script>
    <script src="/static/js/header.js"></script>
    <script src="/static/js/inactivity_logout.js"></script>

</body>
</html>